<html>
  <head>
    <meta charset="utf-8"/>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>

    <script src="skulpt/skulpt.min.js" type="text/javascript"></script>
    <script src="skulpt/skulpt-stdlib.js" type="text/javascript"></script>

    <link rel=stylesheet href="codemirror/lib/codemirror.css">
    <script src="codemirror/lib/codemirror.js"></script>
    <script src="codemirror/mode/python/python.js"></script>
    <script src="codemirror/mode/javascript/javascript.js"></script>
<!--
    <script src="codemirror/mode/css/css.js"></script>
    <script src="codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="codemirror/mode/xml/xml.js"></script>
-->

    <style>
      .CodeMirror { height: auto; border: 1px solid #ddd; }
      .CodeMirror-scroll { max-height: 200px; }
      .CodeMirror pre { padding-left: 7px; line-height: 1.25; }
    </style>


    <script type="text/javascript">
      // Appends some text to a pre element.
      function outputFunction(text) {
        var outputElement = document.getElementById("output");
        outputElement.innerHTML = outputElement.innerHTML + text;
      }

      // Read handler that simply reads the built-in files.
      function readHandler(fileToRead) {
        if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][fileToRead] === undefined) {
          throw "File not found: '" + fileToRead + "'";
        }
        return Sk.builtinFiles["files"][fileToRead];
      }

      function runit(code) {
        var myPromise = Sk.misceval.asyncToPromise(
            function() {
              return Sk.importMainWithBody("<stdin>", false, code, true);
            });

         myPromise.then(
            function(mod) {
              // All is fine.
              // console.log(mod);
            },
            function(err) {
              // Something didn't work right.
              // Print the error to the console.
              console.log(err.toString());
            });
      }

      function setup() {
        var codeElement = document.getElementById("code");
        var outputElement = document.getElementById("output");

        var codeMirror = CodeMirror.fromTextArea(
            codeElement,
            {});

        // Configure Skulpt.
        Sk.pre = "output";
        Sk.configure({
            output: outputFunction,
            read: readHandler});

        // Set the "canvas" (actually a pre) for the turtle module.
        (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'turtle_canvas';

        // Set up the event handler for the Run button.
        document.getElementById("run_button").addEventListener(
            "click",
            function(event) {
              // CodeMirror exposes .getValue()
              var code = (codeMirror && codeMirror.getValue()) || codeElement.value;
              runit(code);
            });
      }

      // Do the setup when document is done loading.
      document.addEventListener(
          "DOMContentLoaded",
          function(event) {
            setup();
          });
    </script>
  </head>

  <body>

    <h3>Try This</h3>

    <form>
      <textarea id="code" cols="80" rows="24"></textarea>

      <br />

      <button id="run_button" type="button">Run</button>
    </form>

    <pre id="output" ></pre>

    <!-- If you want turtle graphics include a canvas -->
    <div id="turtle_canvas"></div>

  </body>
</html>
